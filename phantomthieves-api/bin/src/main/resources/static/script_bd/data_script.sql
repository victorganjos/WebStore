DROP DATABASE PHANTOMTHIEVES;
CREATE DATABASE PHANTOMTHIEVES;
USE PHANTOMTHIEVES;

CREATE TABLE PRODUTO (
  COD_PRODUTO INT(20) NOT NULL AUTO_INCREMENT,
  NOME_PRODUTO VARCHAR(50) DEFAULT NULL,
  CATEGORIA_PRODUTO VARCHAR(50) DEFAULT NULL,
  DESCRICAO_RESUMIDA VARCHAR(250) DEFAULT NULL,
  DESCRICAO_DETALHADA VARCHAR(250) DEFAULT NULL,
  ATIVO TINYINT(1) DEFAULT NULL,
  QT_PRODUTO INT(11) DEFAULT NULL,
  PRECO_PRODUTO DOUBLE DEFAULT NULL,
  PRIMARY KEY (COD_PRODUTO)
);

CREATE TABLE USUARIO(
COD_USUARIO INTEGER AUTO_INCREMENT PRIMARY KEY,
    USER VARCHAR(50),
    PASSWORD VARCHAR(255),
    PASSWORD_CONFIRM VARCHAR(255),
    ATIVO BOOLEAN,
    PERFIL VARCHAR(50)
);

CREATE TABLE IMAGEM_PRODUTO (
COD_IMAGEM INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
NOME_ARQUIVO VARCHAR (255),
LOCAL_ARQUIVO VARCHAR(255),
COD_PRODUTO INTEGER,
CONSTRAINT COD_PRODUTO FOREIGN KEY (COD_PRODUTO) REFERENCES PRODUTO (COD_PRODUTO)
);

CREATE TABLE ROLES(
COD_ROLE INTEGER AUTO_INCREMENT PRIMARY KEY,
    ROLE VARCHAR(50)
);

CREATE TABLE ROLE_USERS(
COD_ROLES_USERS INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
COD_USUARIO INTEGER,
    COD_ROLE INTEGER,
    CONSTRAINT COD_USUARIO foreign key (COD_USUARIO) REFERENCES USUARIO (COD_USUARIO),
    CONSTRAINT COD_ROLE foreign key (COD_ROLE) REFERENCES ROLES (COD_ROLE)
);

CREATE TABLE CLIENTE(
COD_CLIENTE INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
NOME_CLIENTE VARCHAR(100) NOT NULL,
CPF_CLIENTE VARCHAR(14) NOT NULL,
DDD_CLIENTE INTEGER NOT NULL,
TELEPHONE_CLIENTE VARCHAR(10) NOT NULL,
DDD_CONTACT_CLIENTE INTEGER NOT NULL,
TELEPHONE_CONTACT_CLIENTE VARCHAR(10),
DATA_NASCIMENTO_CLIENTE VARCHAR(10),
ENDERECO_CLIENTE VARCHAR(150) NOT NULL,
NUMERO_END_CLIENTE VARCHAR(6)NOT NULL,
CEP_CLIENTE VARCHAR(9),
USER_CLIENTE VARCHAR(50)
);

CREATE TABLE ENDERECO_ENTREGA(
COD_ENDERECO INTEGER NOT NULL AUTO_INCREMENT PRIMARY KEY,
COD_CLIENTE INTEGER NOT NULL,
LOGRADOURO_ENDERECO VARCHAR(150) NOT NULL,
CEP_ENDERECO VARCHAR(9) NOT NULL,
NUMERO_RES_ENDERECO INTEGER NOT NULL,
CONSTRAINT COD_CLIENTE FOREIGN KEY (COD_CLIENTE) REFERENCES CLIENTE (COD_CLIENTE)
);

CREATE VIEW VW_PRODUTO_IMAGEM AS(
SELECT PRO.*,
        IMG.COD_PRODUTO AS COD_PROD_IMG,
        IMG.LOCAL_ARQUIVO,
        IMG.COD_IMAGEM,
        IMG.NOME_ARQUIVO
FROM PRODUTO PRO
INNER JOIN IMAGEM_PRODUTO IMG ON IMG.COD_PRODUTO = PRO.COD_PRODUTO
WHERE PRO.ATIVO = TRUE
);

INSERT INTO ROLES (COD_ROLE, ROLE) VALUES (1, "ROLE_ADMIN");
INSERT INTO ROLES (COD_ROLE,ROLE) VALUES (2,"ROLE_USER");
INSERT INTO ROLES (COD_ROLE,ROLE) VALUES (3,"ROLE_CLIENT");

INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(1,"victor@hotmail",123,true, "Administrador");
INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(2,"giovanni",123,true, "Usuario");
INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(3,"johnnys",123,true, "Administrador");
INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(4,"aldo","$2a$10$jmE8l8W9b1Qx7BMlj32OEuZUtQH6MnwY0vK3gAXAz9r4Wfp3lRece",true, "Administrador");
INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(5,"fabio","$2a$10$zQkHahfd6M9snCeVvCi0A.vJyKxhkM8y6fzh.fafK4t8fdX3bEBVq",true, "Administrador");
INSERT INTO USUARIO (COD_USUARIO,USER, PASSWORD, ATIVO, PERFIL) VALUES(6,"caio","$2a$10$SsWiSsVLS1DImrAAJkTieeLPecQZWaaWfFvhDc7N99vwnogJDaeNm",true, "Usuario");


INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(1,1,1);
INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(2,2,2);
INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(3,3,2);
INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(4,4,1);
INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(5,5,1);
INSERT INTO ROLE_USERS (COD_ROLES_USERS, COD_USUARIO, COD_ROLE) VALUES(6,6,1);


